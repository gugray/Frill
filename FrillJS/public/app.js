"use strict";!function e(n,t,o){function c(i,s){if(!t[i]){if(!n[i]){var a="function"==typeof require&&require;if(!s&&a)return a(i,!0);if(r)return r(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var l=t[i]={exports:{}};n[i][0].call(l.exports,function(e){var t=n[i][1][e];return c(t||e)},l,l.exports,e,n,t,o)}return t[i].exports}for(var r="function"==typeof require&&require,i=0;i<o.length;i++)c(o[i]);return c}({1:[function(e,n,t){!function(e,t){"function"==typeof define&&define.amd?define([],t):void 0!==n&&n.exports?n.exports=t():e.ReconnectingWebSocket=t()}(this,function(){function e(n,t,o){function c(e,n){var t=document.createEvent("CustomEvent");return t.initCustomEvent(e,!1,!1,n),t}var r={debug:!1,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:null};o||(o={});for(var i in r)void 0!==o[i]?this[i]=o[i]:this[i]=r[i];this.url=n,this.reconnectAttempts=0,this.readyState=WebSocket.CONNECTING,this.protocol=null;var s,a=this,d=!1,l=!1,u=document.createElement("div");u.addEventListener("open",function(e){a.onopen(e)}),u.addEventListener("close",function(e){a.onclose(e)}),u.addEventListener("connecting",function(e){a.onconnecting(e)}),u.addEventListener("message",function(e){a.onmessage(e)}),u.addEventListener("error",function(e){a.onerror(e)}),this.addEventListener=u.addEventListener.bind(u),this.removeEventListener=u.removeEventListener.bind(u),this.dispatchEvent=u.dispatchEvent.bind(u),this.open=function(n){if(s=new WebSocket(a.url,t||[]),n){if(this.maxReconnectAttempts&&this.reconnectAttempts>this.maxReconnectAttempts)return}else u.dispatchEvent(c("connecting")),this.reconnectAttempts=0;(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","attempt-connect",a.url);var o=s,r=setTimeout(function(){(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","connection-timeout",a.url),l=!0,o.close(),l=!1},a.timeoutInterval);s.onopen=function(t){clearTimeout(r),(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onopen",a.url),a.protocol=s.protocol,a.readyState=WebSocket.OPEN,a.reconnectAttempts=0;var o=c("open");o.isReconnect=n,n=!1,u.dispatchEvent(o)},s.onclose=function(t){if(clearTimeout(r),s=null,d)a.readyState=WebSocket.CLOSED,u.dispatchEvent(c("close"));else{a.readyState=WebSocket.CONNECTING;var o=c("connecting");o.code=t.code,o.reason=t.reason,o.wasClean=t.wasClean,u.dispatchEvent(o),n||l||((a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onclose",a.url),u.dispatchEvent(c("close")));var r=a.reconnectInterval*Math.pow(a.reconnectDecay,a.reconnectAttempts);setTimeout(function(){a.reconnectAttempts++,a.open(!0)},r>a.maxReconnectInterval?a.maxReconnectInterval:r)}},s.onmessage=function(n){(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onmessage",a.url,n.data);var t=c("message");t.data=n.data,u.dispatchEvent(t)},s.onerror=function(n){(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onerror",a.url,n),u.dispatchEvent(c("error"))}},1==this.automaticOpen&&this.open(!1),this.send=function(n){if(s)return(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","send",a.url,n),s.send(n);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},this.close=function(e,n){void 0===e&&(e=1e3),d=!0,s&&s.close(e,n)},this.refresh=function(){s&&s.close()}}if("WebSocket"in window)return e.prototype.onopen=function(e){},e.prototype.onclose=function(e){},e.prototype.onconnecting=function(e){},e.prototype.onmessage=function(e){},e.prototype.onerror=function(e){},e.debugAll=!1,e.CONNECTING=WebSocket.CONNECTING,e.OPEN=WebSocket.OPEN,e.CLOSING=WebSocket.CLOSING,e.CLOSED=WebSocket.CLOSED,e})},{}],2:[function(e,n,t){e("reconnectingwebsocket");n.exports=function(e){function n(){t.socket.onopen=function(){t.connected=!0,t.sendMyDetails(),document.dispatchEvent(new CustomEvent("dataclient-connected",{detail:{sender:t}}))},t.socket.onmessage=function(e){var n=JSON.parse(e.data);"peers"==n.msg?function(e){var n={},o=[],c=!1,r=!0;if(t.me.id||(c=!0),t.me.id=e.id,c)t.sendMyDetails();else{for(s=0;s<t.peers.length;s++){var i=e.peers.find(function(e){return e.id==t.peers[s].id});i?i.name&&!t.peers[s].name&&(console.log("[DataClient] User "+i.id+" set username:",i.name),console.log("[DataClient] Peers after username update:",e.peers)):(o.push(t.peers[s]),console.log("[DataClient] Peer disconnected:",t.peers[s]),e.sourceId==t.peers[s]&&(n=t.peers[s]))}0==t.peers.length&&0!=e.peers.length&&(console.log("[DataClient] Initial list of peers received from server:",e.peers),r=!1);for(var s=0;s<e.peers.length;s++)e.sourceId==e.peers[s].id&&(n=e.peers[s]),r&&!t.peers.find(function(n){return n.id==e.peers[s].id})&&(console.log("[DataClient] Peer connected:",e.peers[s]),console.log("[DataClient] Peers after new user:",e.peers));t.peers=e.peers,document.dispatchEvent(new CustomEvent("dataclient-peers",{detail:{sender:t,source:n,removedPeers:o}}))}}(n.data):"selection"==n.msg&&function(e){console.log("[DataClient] Peer selection received.",e);var n=t.peers.find(function(n){return n.id==e.id});n&&(n.range=e.range,document.dispatchEvent(new CustomEvent("dataclient-cursor-update",{detail:{sender:t,source:n}})))}(n.data)},t.socket.onclose=function(e){console.log("[DataClient] Socket closed. Event:",e),t.connected=!1,document.dispatchEvent(new CustomEvent("dataclient-disconnected",{detail:{sender:t}}))},t.socket.onerror=function(e){console.log("[DataClient] Error on socket. Event:",e)}}var t={};return t.codeName="dc",t.me=null,t.connected=!1,t.peers=[],t.connect=function(e,o){t.me=new function(e,n){this.id=null,this.name=e,this.color=n}(e,o);var c=("https:"===location.protocol?"wss":"ws")+"://"+window.location.host+"/data";t.socket=new WebSocket(c),n()},t.disconnect=function(){t.socket.close(),delete t.socket,delete t.me,t.peers=[]},t.sendMyDetails=function(){var e={msg:"details",data:t.me};t.socket.send(JSON.stringify(e))},t.selectionChanged=function(e){t.me.range=e;var n={msg:"selection",data:t.me.range};t.socket.send(JSON.stringify(n))},t}},{reconnectingwebsocket:1}],3:[function(e,n,t){function o(e,n,t){var o={},c=0==Object.keys(n.cursors).length;t.peers.forEach(function(r){r.id!=t.me.id&&((r.id==e.id||c)&&r.range&&n.setCursor(r.id,r.range,r.name,r.color),o[r.id]=r)}),Object.keys(n.cursors).forEach(function(e){o[e]||n.removeCursor(e)})}e("./utils");var c=e("./data-client")();c.codeName="dc1";var r=e("./data-client")();r.codeName="dc2";var i,s,a,d,l={theme:"snow",modules:{cursors:{autoRegisterListener:!1},history:{userOnly:!0}},readOnly:!0};$(document).ready(function(){Quill.register("modules/cursors",QuillCursors),i=new Quill("#editorL",l),s=new Quill("#editorR",l),$(".editorWrap").removeClass("hidden"),function(e){e.forEach(function(e){var n=e[0],t=e[1];t.find(".connect input[type='button']").click(function(){if(!$(this).hasClass("disabled")){if(n.connected)n.disconnect();else{var e=t.find(".connect input[type='text']").val(),o="dc1"==n.codeName?"red":"blue";n.connect(e,o)}$(this).addClass("disabled")}})}),document.addEventListener("dataclient-connected",function(e,n){var t=null;"dc1"==e.detail.sender.codeName?(t=$(".half.left .connect input[type='button']"),i.enable(),o(c.me,a,c)):(t=$(".half.right .connect input[type='button']"),s.enable(),o(r.me,d,r)),t.attr("value","Disconnect"),t.removeClass("disabled")}),document.addEventListener("dataclient-disconnected",function(e){var n;"dc1"==e.detail.sender.codeName?(n=$(".half.left .connect input[type='button']"),i.disable()):(n=$(".half.right .connect input[type='button']"),s.disable()),n.attr("value","Connect"),n.removeClass("disabled")}),document.addEventListener("dataclient-peers",function(e){"dc1"==e.detail.sender.codeName?o(e.detail.source,a,c):"dc2"==e.detail.sender.codeName&&o(e.detail.source,d,r)})}([[c,$(".half.left")],[r,$(".half.right")]]),(a=i.getModule("cursors")).registerTextChangeListener(),(d=s.getModule("cursors")).registerTextChangeListener(),i.on("selection-change",function(e,n,t){c.selectionChanged(e)}),s.on("selection-change",function(e,n,t){r.selectionChanged(e)}),document.addEventListener("dataclient-cursor-update",function(e){"dc1"==e.detail.sender.codeName?o(e.detail.source,a,c):"dc2"==e.detail.sender.codeName&&o(e.detail.source,d,r)})})},{"./data-client":2,"./utils":4}],4:[function(e,n,t){t.debounce=function(e,n,t){var o;return function(){var c=this,r=arguments,i=t&&!o;clearTimeout(o),o=setTimeout(function(){o=null,t||e.apply(c,r)},n),i&&e.apply(c,r)}}},{}]},{},[3]);
//# sourceMappingURL=app.js.map
